class_name ExperienceBar
extends ProgressBar

# [niveau, xp max, palier xp]
var paliers = [[1,0,0],
	[2,110,110],
	[3,650,540],
	[4,1500,850],
	[5,2800,1300],
	[6,4800,2000],
	[7,7300,2500],
	[8,10500,3200],
	[9,14500,4000],
	[10,19200,4700],
	[11,25200,6000],
	[12,32600,7400],
	[13,41000,8400],
	[14,50500,9500],
	[15,61000,10500],
	[16,75000,14000],
	[17,91000,16000],
	[18,115000,24000],
	[19,142000,27000],
	[20,171000,29000],
	[21,202000,31000],
	[22,235000,33000],
	[23,270000,35000],
	[24,310000,40000],
	[25,353000,43000],
	[26,398500,45500],
	[27,448000,49500],
	[28,503000,55000],
	[29,561000,58000],
	[30,621600,60600],
	[31,687000,65400],
	[32,755000,68000],
	[33,829000,74000],
	[34,910000,81000],
	[35,1000000,90000],
	[36,1100000,100000],
	[37,1240000,140000],
	[38,1400000,160000],
	[39,1580000,180000],
	[40,1780000,200000],
	[41,2000000,220000],
	[42,2250000,250000],
	[43,2530000,280000],
	[44,2850000,320000],
	[45,3200000,350000],
	[46,3570000,370000],
	[47,3960000,390000],
	[48,4400000,440000],
	[49,4860000,460000],
	[50,5350000,490000],
	[51,5860000,510000],
	[52,6390000,530000],
	[53,6950000,560000],
	[54,7530000,580000],
	[55,8130000,600000],
	[56,8765100,635100],
	[57,9420000,654900],
	[58,10150000,730000],
	[59,10894000,744000],
	[60,11655000,761000],
	[61,12450000,795000],
	[62,13280000,830000],
	[63,14130000,850000],
	[64,15170000,1040000],
	[65,16251000,1081000],
	[66,17377000,1126000],
	[67,18553000,1176000],
	[68,19778000,1225000],
	[69,21055000,1277000],
	[70,22385000,1330000],
	[71,23529000,1144000],
	[72,25209000,1680000],
	[73,26707000,1498000],
	[74,28264000,1557000],
	[75,29882000,1618000],
	[76,31563000,1681000],
	[77,33307000,1744000],
	[78,35118000,1811000],
	[79,36997000,1879000],
	[80,38945000,1948000],
	[81,40965000,2020000],
	[82,43059000,2094000],
	[83,45229000,2170000],
	[84,47476000,2247000],
	[85,49803000,2327000],
	[86,52211000,2408000],
	[87,54704000,2493000],
	[88,57284000,2580000],
	[89,59952000,2668000],
	[90,62712000,2760000],
	[91,65565000,2853000],
	[92,68514000,2949000],
	[93,71561000,3047000],
	[94,74710000,3149000],
	[95,77963000,3253000],
	[96,81323000,3360000],
	[97,84792000,3469000],
	[98,88374000,3582000],
	[99,92071000,3697000],
	[100,95886000,3815000],
	[101,99823000,3937000],
	[102,103885000,4062000],
	[103,108075000,4190000],
	[104,112396000,4321000],
	[105,116853000,4457000],
	[106,121447000,4594000],
	[107,126184000,4737000],
	[108,131066000,4882000],
	[109,136098000,5032000],
	[110,141283000,5185000],
	[111,146626000,5343000],
	[112,152130000,5504000],
	[113,157800000,5670000],
	[114,163640000,5840000],
	[115,169655000,6015000],
	[116,175848000,6193000],
	[117,182225000,6377000],
	[118,188791000,6566000],
	[119,195550000,6759000],
	[120,202507000,6957000],
	[121,209667000,7160000],
	[122,217037000,7370000],
	[123,224620000,7583000],
	[124,232424000,7804000],
	[125,240452000,8028000],
	[126,248712000,8260000],
	[127,257209000,8497000],
	[128,265949000,8740000],
	[129,274939000,8990000],
	[130,284186000,9247000],
	[131,293694000,9508000],
	[132,303473000,9779000],
	[133,313527000,10054000],
	[134,323866000,10339000],
	[135,334495000,10629000],
	[136,345423000,10928000],
	[137,356657000,11234000],
	[138,368206000,11549000],
	[139,380076000,11870000],
	[140,392278000,12202000],
	[141,404818000,12540000],
	[142,417706000,12888000],
	[143,430952000,13246000],
	[144,444564000,13612000],
	[145,458551000,13987000],
	[146,472924000,14373000],
	[147,487693000,14769000],
	[148,502867000,15174000],
	[149,518458000,15591000],
	[150,534476000,16018000],
	[151,551000000,16524000],
	[152,567839000,16839000],
	[153,585206000,17367000],
	[154,603047000,17841000],
	[155,621374000,18327000],
	[156,640199000,18825000],
	[157,659536000,19337000],
	[158,679398000,19862000],
	[159,699798000,20400000],
	[160,720751000,20953000],
	[161,742272000,21521000],
	[162,764374000,22102000],
	[163,787074000,22700000],
	[164,810387000,23313000],
	[165,834329000,23942000],
	[166,858917000,24588000],
	[167,884167000,25250000],
	[168,910098000,25931000],
	[169,936727000,26629000],
	[170,964073000,27346000],
	[171,992154000,28081000],
	[172,1020991000,28837000],
	[173,1050603000,29612000],
	[174,1081010000,30407000],
	[175,1112235000,31225000],
	[176,1144298000,32063000],
	[177,1177222000,32924000],
	[178,1211030000,33808000],
	[179,1245745000,34715000],
	[180,1281393000,35648000],
	[181,1317997000,36604000],
	[182,1355584000,37587000],
	[183,1404179000,48595000],
	[184,1463811000,59632000],
	[185,1534506000,70695000],
	[186,1616294000,81788000],
	[187,1709205000,92911000],
	[188,1813267000,104062000],
	[189,1928513000,115246000],
	[190,2054975000,126462000],
	[191,2192686000,137711000],
	[192,2341679000,148993000],
	[193,2501990000,160311000],
	[194,2673655000,171665000],
	[195,2856710000,183055000],
	[196,3051194000,194484000],
	[197,3257146000,205952000],
	[198,3474606000,217460000],
	[199,3703616000,229010000],
	[200,5555424000,1851808000]]

@export var lvl_label: Label

var cur_lvl: int
var tooltip: Tooltip

signal lvl_up

var xp_label: String:
	get: return "%d / %d" % [value, max_value]

func init():
	cur_lvl = 1
	value = 0
	update_max_value()
	update_lvl_label()
	var over_ui = get_tree().current_scene.get_node("OverUI")
	tooltip = Tooltip.create(xp_label, over_ui, self)


func reset():
	tooltip.queue_free()
	init()


func gain_xp(amount: int):
	value += amount
	while value >= max_value:
		value -= max_value
		cur_lvl += 1
		update_max_value()
		lvl_up.emit()
	update_lvl_label()
	tooltip.update_text(xp_label)


func update_lvl_label():
	lvl_label.text = "Nv. " + str(cur_lvl)


func update_max_value():
	max_value = paliers[cur_lvl][2]


func get_lvl(xp_amount: int):
	var lvl := 0
	for palier in paliers:
		if xp_amount > palier[1]:
			lvl = palier[0]
		else:
			return lvl
	return 200


func get_total_xp():
	if cur_lvl == 0:
		return value
	return paliers[cur_lvl - 1][1] + value
